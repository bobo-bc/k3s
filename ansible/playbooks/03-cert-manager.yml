- hosts: masters
  tasks:
    - name: Install cert-manager via Helm
      community.kubernetes.helm:
        name: cert-manager
        chart_ref: jetstack/cert-manager
        chart_repo_url: https://charts.jetstack.io
        release_namespace: cert-manager
        create_namespace: true
        values:
          installCRDs: true

    - name: Apply self-signed ClusterIssuer
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: cert-manager.io/v1
          kind: ClusterIssuer
          metadata:
            name: selfsigned-issuer
          spec:
            selfSigned: {}
